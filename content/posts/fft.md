+++
banner = ""
categories = ["Mathematics", "Programming"]
date = 2019-09-22T17:02:42+09:00
description = "高速フーリエ変換 (FFT: Fast Fourier Transform) の実装を理解する"
images = []
menu = ""
tags = ["Mathematics", "Fast Fourier Transform", "FFT"]
title = "FFT"
disable_comments = false
disable_profile = true
disable_widgets = false
+++

<b>高速フーリエ変換</b> (<b>FFT</b> : Fast Fourier Transform) とは, 離散フーリエ変換のサイズが <b>2 のべき乗</b>の場合に, 高速に計算できるアルゴリズムのことです.

## アルゴリズムの導出

離散フーリエ変換のサイズ ($N$) が 8 の場合を例に導出します.

$
\begin{eqnarray}
X(k)=\sum\_{n=0}^{N-1}x(n)\exp\left(\frac{-j2\pi kn}{N}\right)
\end{eqnarray}
$

離散フーリエ変換の公式は, 以下のように行列で表現することができます.

$
\begin{eqnarray}
x(n)=\left[
\begin{array}{c}
x(0) \\\\\\
x(1) \\\\\\
x(2) \\\\\\
x(3) \\\\\\
x(4) \\\\\\
x(5) \\\\\\
x(6) \\\\\\
x(7) \\\\\\
\end{array}
\right]
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{c}
X(0) \\\\\\
X(1) \\\\\\
X(2) \\\\\\
X(3) \\\\\\
X(4) \\\\\\
X(5) \\\\\\
X(6) \\\\\\
X(7) \\\\\\
\end{array}
\right]
\end{eqnarray}
$

$
\begin{eqnarray}
W\_{8}=\exp\left(\frac{-j2\pi}{8}\right)
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{cccccccc}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} \\\\\\
W^{0}\_{8} & W^{1}\_{8} &  W^{2}\_{8} &  W^{3}\_{8} &  W^{4}\_{8} &  W^{5}\_{8} &  W^{6}\_{8} &  W^{7}\_{8} \\\\\\
W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} &  W^{8}\_{8} & W^{10}\_{8} & W^{12}\_{8} & W^{14}\_{8} \\\\\\
W^{0}\_{8} & W^{3}\_{8} &  W^{6}\_{8} &  W^{9}\_{8} & W^{12}\_{8} & W^{15}\_{8} & W^{18}\_{8} & W^{21}\_{8} \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} & W^{16}\_{8} & W^{20}\_{8} & W^{24}\_{8} & W^{28}\_{8} \\\\\\
W^{0}\_{8} & W^{5}\_{8} & W^{10}\_{8} & W^{15}\_{8} & W^{20}\_{8} & W^{25}\_{8} & W^{30}\_{8} & W^{35}\_{8} \\\\\\
W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} & W^{24}\_{8} & W^{30}\_{8} & W^{36}\_{8} & W^{42}\_{8} \\\\\\
W^{0}\_{8} & W^{7}\_{8} & W^{14}\_{8} & W^{21}\_{8} & W^{28}\_{8} & W^{35}\_{8} & W^{42}\_{8} & W^{49}\_{8} \\\\\\
\end{array}
\right]x(n)
\end{eqnarray}
$

ここで, 以下の関係 (オイラーの公式から導出できます) を考慮して, 行列を書き換えます.

$
\begin{eqnarray}
W^{m}\_{N}=W^{m(mod N)}\_{N}
\end{eqnarray}
$

例えば, $W^{8}\_{8}=W^{0}\_{8}$, $W^{9}\_{8}=W^{1}\_{8}$, $W^{10}\_{8}=W^{2}\_{8}$ ...

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{cccccccc}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} \\\\\\
W^{0}\_{8} & W^{1}\_{8} &  W^{2}\_{8} &  W^{3}\_{8} & W^{4}\_{8} &  W^{5}\_{8} &  W^{6}\_{8} &  W^{7}\_{8} \\\\\\
W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} & W^{0}\_{8} &  W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} \\\\\\
W^{0}\_{8} & W^{3}\_{8} &  W^{6}\_{8} &  W^{9}\_{8} & W^{4}\_{8} &  W^{7}\_{8} & W^{10}\_{8} & W^{13}\_{8} \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} & W^{0}\_{8} &  W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} \\\\\\
W^{0}\_{8} & W^{5}\_{8} & W^{10}\_{8} & W^{15}\_{8} & W^{4}\_{8} &  W^{9}\_{8} & W^{14}\_{8} & W^{19}\_{8} \\\\\\
W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} & W^{0}\_{8} &  W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} \\\\\\
W^{0}\_{8} & W^{7}\_{8} & W^{14}\_{8} & W^{21}\_{8} & W^{4}\_{8} & W^{11}\_{8} & W^{18}\_{8} & W^{25}\_{8} \\\\\\
\end{array}
\right]x(n)
\end{eqnarray}
$

そして, 行列の行を偶奇にわけて, 並び替えます.

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{c}
X(0) \\\\\\
X(4) \\\\\\
X(2) \\\\\\
X(6) \\\\\\
X(1) \\\\\\
X(5) \\\\\\
X(3) \\\\\\
X(7) \\\\\\
\end{array}
\right]
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{cccccccc}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} & W^{0}\_{8} &  W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} \\\\\\
W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} & W^{0}\_{8} &  W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} \\\\\\
W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} & W^{0}\_{8} &  W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} \\\\\\
W^{0}\_{8} & W^{1}\_{8} &  W^{2}\_{8} &  W^{3}\_{8} & W^{4}\_{8} &  W^{5}\_{8} &  W^{6}\_{8} &  W^{7}\_{8} \\\\\\
W^{0}\_{8} & W^{5}\_{8} & W^{10}\_{8} & W^{15}\_{8} & W^{4}\_{8} &  W^{9}\_{8} & W^{14}\_{8} & W^{19}\_{8} \\\\\\
W^{0}\_{8} & W^{3}\_{8} &  W^{6}\_{8} &  W^{9}\_{8} & W^{4}\_{8} &  W^{7}\_{8} & W^{10}\_{8} & W^{13}\_{8} \\\\\\
W^{0}\_{8} & W^{7}\_{8} & W^{14}\_{8} & W^{21}\_{8} & W^{4}\_{8} & W^{11}\_{8} & W^{18}\_{8} & W^{25}\_{8} \\\\\\
\end{array}
\right]x(n)
\end{eqnarray}
$

すると, 行列の列の中央を境目に, <b>偶数のインデックスの行は左右の周期が対称に</b>, <b>奇数のインデックスの行は半周期</b> ($N=8$ なので 4 ずつずれている) ことがわかります.

そこで, 以下の関係を考慮します.

$
\begin{eqnarray}
\begin{cases}
W^{0}\_{8}=1 \\\\\
W^{4}\_{8}=-1 \\\\\
\end{cases}
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &   W^{0}\_{8} &   W^{0}\_{8} \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} &  W^{0}\_{8} &  W^{4}\_{8} &   W^{8}\_{8} &  W^{12}\_{8} \\\\\\
W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} &  W^{0}\_{8} &  W^{2}\_{8} &   W^{4}\_{8} &   W^{6}\_{8} \\\\\\
W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} &  W^{0}\_{8} &  W^{6}\_{8} &  W^{12}\_{8} &  W^{18}\_{8} \\\\\\
W^{0}\_{8} & W^{1}\_{8} &  W^{2}\_{8} &  W^{3}\_{8} & -W^{0}\_{8} & -W^{1}\_{8} &  -W^{2}\_{8} &  -W^{3}\_{8} \\\\\\
W^{0}\_{8} & W^{5}\_{8} & W^{10}\_{8} & W^{15}\_{8} & -W^{0}\_{8} & -W^{5}\_{8} & -W^{10}\_{8} & -W^{15}\_{8} \\\\\\
W^{0}\_{8} & W^{3}\_{8} &  W^{6}\_{8} &  W^{9}\_{8} & -W^{0}\_{8} & -W^{3}\_{8} &  -W^{6}\_{8} &  -W^{9}\_{8} \\\\\\
W^{0}\_{8} & W^{7}\_{8} & W^{14}\_{8} & W^{21}\_{8} & -W^{0}\_{8} & -W^{7}\_{8} & -W^{14}\_{8} & -W^{21}\_{8} \\\\\\
\end{array}
\right]x(n)
\end{eqnarray}
$

そして,

$
\begin{eqnarray}
W^{a}W^{b}=W^{a+b}
\end{eqnarray}
$

であるので,

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &            W^{0}\_{8} &            W^{0}\_{8} &             W^{0}\_{8} &             W^{0}\_{8} \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} &            W^{0}\_{8} &            W^{4}\_{8} &             W^{8}\_{8} &            W^{12}\_{8} \\\\\\
W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} &            W^{0}\_{8} &            W^{2}\_{8} &             W^{4}\_{8} &             W^{6}\_{8} \\\\\\
W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} &            W^{0}\_{8} &            W^{6}\_{8} &            W^{12}\_{8} &            W^{18}\_{8} \\\\\\
W^{0}\_{8} & W^{1}\_{8} &  W^{2}\_{8} &  W^{3}\_{8} & -W^{0}\_{8}W^{0}\_{8} & -W^{1}\_{8}W^{0}\_{8} & -W^{2}\_{8}W^{0}\_{8}  & -W^{3}\_{8}W^{0}\_{8}  \\\\\\
W^{0}\_{8} & W^{5}\_{8} & W^{10}\_{8} & W^{15}\_{8} & -W^{0}\_{8}W^{0}\_{8} & -W^{1}\_{8}W^{4}\_{8} & -W^{2}\_{8}W^{8}\_{8}  & -W^{3}\_{8}W^{12}\_{8} \\\\\\
W^{0}\_{8} & W^{3}\_{8} &  W^{6}\_{8} &  W^{9}\_{8} & -W^{0}\_{8}W^{0}\_{8} & -W^{1}\_{8}W^{2}\_{8} & -W^{2}\_{8}W^{4}\_{8}  & -W^{3}\_{8}W^{6}\_{8}  \\\\\\
W^{0}\_{8} & W^{7}\_{8} & W^{14}\_{8} & W^{21}\_{8} & -W^{0}\_{8}W^{0}\_{8} & -W^{1}\_{8}W^{6}\_{8} & -W^{2}\_{8}W^{12}\_{8} & -W^{3}\_{8}W^{18}\_{8} \\\\\\
\end{array}
\right]x(n)
\end{eqnarray}
$

時間ドメインの関数を以下のように置き換えて, 行列をさらに書き換えます.

$
\begin{eqnarray}
x\_{1}(n)=\left[
\begin{array}{l}
x(0)+x(4) \\\\\\
x(1)+x(5) \\\\\\
x(2)+x(6) \\\\\\
x(3)+x(7) \\\\\\
W^{0}\_{8}(x(0)-x(4)) \\\\\\
W^{1}\_{8}(x(1)-x(5)) \\\\\\
W^{2}\_{8}(x(2)-x(6)) \\\\\\
W^{3}\_{8}(x(3)-x(7)) \\\\\\
\end{array}
\right]
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &          0 &          0 &           0 &           0 \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} &          0 &          0 &           0 &           0 \\\\\\
W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} &          0 &          0 &           0 &           0 \\\\\\
W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} &          0 &          0 &           0 &           0 \\\\\\
         0 &          0 &           0 &           0 & W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} \\\\\\
         0 &          0 &           0 &           0 & W^{0}\_{8} & W^{4}\_{8} &  W^{8}\_{8} & W^{12}\_{8} \\\\\\
         0 &          0 &           0 &           0 & W^{0}\_{8} & W^{2}\_{8} &  W^{4}\_{8} &  W^{6}\_{8} \\\\\\
         0 &          0 &           0 &           0 & W^{0}\_{8} & W^{6}\_{8} & W^{12}\_{8} & W^{18}\_{8} \\\\\\
\end{array}
\right]x\_{1}(n)
\end{eqnarray}
$

最後に, 以下の関係を考慮して, 行列を書き換えます.

$
\begin{eqnarray}
W^{m}\_{N}=W^{m/2}\_{N/2}
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{4} & W^{0}\_{4} & W^{0}\_{4} & W^{0}\_{4} &          0 &          0 &          0 &          0 \\\\\\
W^{0}\_{4} & W^{2}\_{4} & W^{4}\_{4} & W^{6}\_{4} &          0 &          0 &          0 &          0 \\\\\\
W^{0}\_{4} & W^{1}\_{4} & W^{2}\_{4} & W^{3}\_{4} &          0 &          0 &          0 &          0 \\\\\\
W^{0}\_{4} & W^{3}\_{4} & W^{6}\_{4} & W^{9}\_{4} &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 &           0 &         0 & W^{0}\_{4} & W^{0}\_{4} & W^{0}\_{4} & W^{0}\_{4} \\\\\\
         0 &          0 &           0 &         0 & W^{0}\_{4} & W^{2}\_{4} & W^{4}\_{4} & W^{6}\_{4} \\\\\\
         0 &          0 &           0 &         0 & W^{0}\_{4} & W^{1}\_{4} & W^{2}\_{4} & W^{3}\_{4} \\\\\\
         0 &          0 &           0 &         0 & W^{0}\_{4} & W^{3}\_{4} & W^{6}\_{4} & W^{9}\_{4} \\\\\\
\end{array}
\right]x\_{1}(n)
\end{eqnarray}
$

この行列は, <b>離散フーリエ変換のサイズを $N=4$ に減らして高速化できることを意味します</b>.

さらに, この行列をみると, <b>再帰的な構造</b>があることがわかるので, 同様の手順で行列を書き換えます.

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} &           0 &          0 &           0 &           0 \\\\\\
W^{0}\_{8} & W^{4}\_{8} &  W^{0}\_{8} &  W^{4}\_{8} &           0 &          0 &           0 &           0 \\\\\\
W^{0}\_{8} & W^{2}\_{8} & -W^{0}\_{8} & -W^{2}\_{8} &           0 &          0 &           0 &           0 \\\\\\
W^{0}\_{8} & W^{6}\_{8} & -W^{0}\_{8} & -W^{6}\_{8} &           0 &          0 &           0 &           0 \\\\\\
         0 &          0 &           0 &           0 &  W^{0}\_{8} & W^{0}\_{8} &  W^{0}\_{8} &  W^{0}\_{8} \\\\\\
         0 &          0 &           0 &           0 &  W^{0}\_{8} & W^{4}\_{8} &  W^{0}\_{8} &  W^{4}\_{8} \\\\\\
         0 &          0 &           0 &           0 &  W^{0}\_{8} & W^{2}\_{8} & -W^{0}\_{8} & -W^{2}\_{8} \\\\\\
         0 &          0 &           0 &           0 &  W^{0}\_{8} & W^{6}\_{8} & -W^{0}\_{8} & -W^{6}\_{8} \\\\\\
\end{array}
\right]x\_{1}(n)
\end{eqnarray}
$

$
\begin{eqnarray}
x\_{2}(n)=\left[
\begin{array}{l}
x\_{1}(0)+x\_{1}(2) \\\\\\
x\_{1}(1)+x\_{1}(3) \\\\\\
W^{0}\_{8}(x\_{1}(0)-x\_{1}(2)) \\\\\\
W^{2}\_{8}(x\_{1}(1)-x\_{1}(3)) \\\\\\
x\_{1}(4)+x\_{1}(6) \\\\\\
x\_{1}(5)+x\_{1}(7) \\\\\\
W^{0}\_{8}(x\_{1}(4)-x\_{1}(6)) \\\\\\
W^{2}\_{8}(x\_{1}(5)-x\_{1}(7)) \\\\\\
\end{array}
\right]
\end{eqnarray}
$

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{8} & W^{0}\_{8} &          0 &          0 &          0 &          0 &          0 &          0 \\\\\\
W^{0}\_{8} & W^{4}\_{8} &          0 &          0 &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 & W^{0}\_{8} & W^{0}\_{8} &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 & W^{0}\_{8} & W^{4}\_{8} &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 &          0 &          0 & W^{0}\_{8} & W^{0}\_{8} &          0 &          0 \\\\\\
         0 &          0 &          0 &          0 & W^{0}\_{8} & W^{4}\_{8} &          0 &          0 \\\\\\
         0 &          0 &          0 &          0 &          0 &          0 & W^{0}\_{8} & W^{0}\_{8} \\\\\\
         0 &          0 &          0 &          0 &          0 &          0 & W^{0}\_{8} & W^{4}\_{8} \\\\\\
\end{array}
\right]x\_{2}(n)
\end{eqnarray}
$

$W^{m}\_{N}=W^{m/2}\_{N/2}$ の関係があるので,

$
\begin{eqnarray}
X(k)=\left[
\begin{array}{rrrrrrrr}
W^{0}\_{2} & W^{0}\_{2} &          0 &          0 &          0 &          0 &          0 &          0 \\\\\\
W^{0}\_{2} & W^{1}\_{2} &          0 &          0 &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 & W^{0}\_{2} & W^{0}\_{2} &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 & W^{0}\_{2} & W^{1}\_{2} &          0 &          0 &          0 &          0 \\\\\\
         0 &          0 &          0 &          0 & W^{0}\_{2} & W^{0}\_{2} &          0 &          0 \\\\\\
         0 &          0 &          0 &          0 & W^{0}\_{2} & W^{1}\_{2} &          0 &          0 \\\\\\
         0 &          0 &          0 &          0 &          0 &          0 & W^{0}\_{2} & W^{0}\_{2} \\\\\\
         0 &          0 &          0 &          0 &          0 &          0 & W^{0}\_{2} & W^{1}\_{2} \\\\\\
\end{array}
\right]x\_{3}(n)
\end{eqnarray}
$

$
\begin{eqnarray}
x\_{3}(n)=\left[
\begin{array}{l}
x\_{2}(0)+x\_{2}(1) \\\\\\
x\_{2}(0)+x\_{2}(1) \\\\\\
x\_{2}(2)+x\_{2}(3) \\\\\\
x\_{2}(2)+x\_{2}(3) \\\\\\
x\_{2}(4)+x\_{2}(5) \\\\\\
x\_{2}(4)+x\_{2}(5) \\\\\\
x\_{2}(6)+x\_{2}(7) \\\\\\
x\_{2}(6)+x\_{2}(7) \\\\\\
\end{array}
\right]
\end{eqnarray}
$

この行列は, <b>離散フーリエ変換のサイズを $N=2$ に減らして高速化できることを意味します</b>.

## ビットリバース

高速フーリエ変換のアルゴリズム導出のさいに, 行列の列を並び替えているので, $X(k)$ のインデックスを昇順に並び替える必要があります.

並び替えるまえと並び替えたあとのインデックスには, 以下の関係があります.

<table>
  <caption>ビットリバース</caption>
  <thead>
    <tr><th scope="col">$x(n)$</th><th scope="col">a</th><th scope="col">b</th><th scope="col">$X(k)$</th></tr>
  </thead>
  <tbody>
    <tr><td>0</td><td>000</td><td>000</td><td>0</td></tr>
    <tr><td>1</td><td>001</td><td>100</td><td>4</td></tr>
    <tr><td>2</td><td>010</td><td>010</td><td>2</td></tr>
    <tr><td>3</td><td>011</td><td>110</td><td>6</td></tr>
    <tr><td>4</td><td>100</td><td>001</td><td>1</td></tr>
    <tr><td>5</td><td>101</td><td>101</td><td>5</td></tr>
    <tr><td>6</td><td>110</td><td>011</td><td>3</td></tr>
    <tr><td>7</td><td>111</td><td>111</td><td>7</td></tr>
  </tbody>
</table>

上記のテーブルより, 並び替えるまえのインデックスを 2 進数に変換し, そのビットをの並びを逆にして, 10 進数に変換したインデックスが並び替えたあとのインデックスということです. このアルゴリズムは, <b>ビットリバース</b>と呼ばれています.

## 計算量

行列の書き換え過程をダイアグラムにしたのが以下の図で, <b>バタフライ計算</b>と呼ばれています.

![FFT (バタフライ計算)](https://user-images.githubusercontent.com/4006693/66152511-8f759580-e654-11e9-912e-0e8e61be7fd0.png)

離散フーリエ変換のサイズが $N$ の高速フーリエ変換は, $\log\_{2}N$ 段で計算できます. このとき, 最後の段以外は $N/2$ 回の乗算と $N$ 回の加算, 最後の段は $N$ 回の加算となるので, 高速フーリエ変換のオーダーは, $N\log\_{2}N$ となります. 離散フーリエ変換のオーダーが $N^{2}$ であることを考えると, $N$ が大きいほど, 高速フーリエ変換はより有効であると言えます.

## 実装

C++ で実装した, 高速フーリエ変換と逆高速フーリエ変換の関数です.

FFT

```c++
#include <vector>
#include <cmath>
#include <complex>

int pow2(int n) {
  if (n == 0) {
    return 1;
  }

  return 2 << (n - 1);
}

void FFT(std::vector<std::complex<double>> &x, int N) {
  std::vector<int> index(N);

  int number_of_stages = std::log2(N);

  for (int stage = 1; stage <= number_of_stages; stage++) {
    for (int i = 0; i < pow2(stage - 1); i++) {
      int rest = number_of_stages - stage;

      for (int j = 0; j < pow2(rest); j++) {
        int n = i * pow2(rest + 1) + j;
        int m = pow2(rest) + n;
        int r = j * pow2(stage - 1);

        double a_real = x[n].real();
        double a_imag = x[n].imag();
        double b_real = x[m].real();
        double b_imag = x[m].imag();
        double c_real = std::cos((2.0 * M_PI * r) / N);
        double c_imag = -std::sin((2.0 * M_PI * r) / N);

        if (stage < number_of_stages) {
          x[n] = std::complex<double>((a_real + b_real), (a_imag + b_imag));
          x[m] = std::complex<double>((c_real * (a_real - b_real)) - (c_imag * (a_imag - b_imag)), (c_real * (a_imag - b_imag)) + (c_imag * (a_real - b_real)));
        } else {
          x[n] = std::complex<double>((a_real + b_real), (a_imag + b_imag));
          x[m] = std::complex<double>((a_real - b_real), (a_imag - b_imag));
        }
      }
    }
  }

  for (int stage = 1; stage <= number_of_stages; stage++) {
    int rest = number_of_stages - stage;

    for (int i = 0; i < pow2(stage - 1); i++) {
      index[pow2(stage - 1) + i] = index[i] + pow2(rest);
    }
  }

  for (int k = 0; k < N; k++) {
    if (index[k] <= k) {
      continue;
    }

    auto tmp    = x[index[k]];
    x[index[k]] = x[k];
    x[k]        = tmp;
  }
}
```

IFFT

```c++
#include <vector>
#include <cmath>
#include <complex>

int pow2(int n) {
  if (n == 0) {
    return 1;
  }

  return 2 << (n - 1);
}

void IFFT(std::vector<std::complex<double>> &x, int N) {
  std::vector<int> index(N);

  int number_of_stages = std::log2(N);

  for (int stage = 1; stage <= number_of_stages; stage++) {
    for (int i = 0; i < pow2(stage - 1); i++) {
      int rest = number_of_stages - stage;

      for (int j = 0; j < pow2(rest); j++) {
        int n = i * pow2(rest + 1) + j;
        int m = pow2(rest) + n;
        int r = j * pow2(stage - 1);

        double a_real = x[n].real();
        double a_imag = x[n].imag();
        double b_real = x[m].real();
        double b_imag = x[m].imag();
        double c_real = std::cos((2.0 * M_PI * r) / N);
        double c_imag = std::sin((2.0 * M_PI * r) / N);

        if (stage < number_of_stages) {
          x[n] = std::complex<double>((a_real + b_real), (a_imag + b_imag));
          x[m] = std::complex<double>((c_real * (a_real - b_real)) - (c_imag * (a_imag - b_imag)), (c_real * (a_imag - b_imag)) + (c_imag * (a_real - b_real)));
        } else {
          x[n] = std::complex<double>((a_real + b_real), (a_imag + b_imag));
          x[m] = std::complex<double>((a_real - b_real), (a_imag - b_imag));
        }
      }
    }
  }

  for (int stage = 1; stage <= number_of_stages; stage++) {
    int rest = number_of_stages - stage;

    for (int i = 0; i < pow2(stage - 1); i++) {
      index[pow2(stage - 1) + i] = index[i] + pow2(rest);
    }
  }

  for (int k = 0; k < N; k++) {
    if (index[k] <= k) {
      continue;
    }

    auto tmp    = x[index[k]];
    x[index[k]] = x[k];
    x[k]        = tmp;
  }

  for (int k = 0; k < N; k++) {
    x[k] = std::complex<double>((x[k].real() / N), (x[k].imag() / N));
  }
}

```

# リファレンス

- [C言語ではじめる音のプログラミング―サウンドエフェクトの信号処理](https://www.amazon.co.jp/C%E8%A8%80%E8%AA%9E%E3%81%A7%E3%81%AF%E3%81%98%E3%82%81%E3%82%8B%E9%9F%B3%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E2%80%95%E3%82%B5%E3%82%A6%E3%83%B3%E3%83%89%E3%82%A8%E3%83%95%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BF%A1%E5%8F%B7%E5%87%A6%E7%90%86-%E9%9D%92%E6%9C%A8-%E7%9B%B4%E5%8F%B2/dp/4274206505)
